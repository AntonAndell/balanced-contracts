{
  "title": "Loans: Withdraw Collateral ",
  "description": "Test cases for the withdrawCollateral function.",
  "stories": [
    {
      "description": "User 1 deposits 500 ICX as collateral and borrows 50 ICD loan",
      "actions": {
        "prev_sicx_bal_loan": "0",
        "prev_icd_debt_bal_loan": "0",
        "sender": "user1",
        "name": "addCollateral",
        "deposited_icx": "500000000000000000000",
        "args": {
          "_asset": "ICD",
          "_amount": "50000000000000000000"
        },
        "expected": "1",
        "expected_sicx_baln_loan": "500000000000000000000",
        "expected_icd_debt_baln_loan": "50000000000000000000"
      }
    },
    {
      "description": "User 1 withdraws 50 ICX from the available collateral",
      "actions": {
        "prev_sicx_bal_loan": "500000000000000000000",
        "prev_icd_debt_bal_loan": "50000000000000000000",
        "sender": "user1",
        "name": "withdrawCollateral",
        "args": {
          "_value": "50000000000000000000"
        },
        "expected": "1",
        "expected_sicx_baln_loan": "450000000000000000000",
        "expected_icd_debt_baln_loan": "50000000000000000000"
      }
    },
    {
      "description": "User 1 withdraws 330 ICX from the available collateral",
      "actions": {
        "prev_sicx_bal_loan": "450000000000000000000",
        "prev_icd_debt_bal_loan": "50000000000000000000",
        "sender": "user1",
        "name": "withdrawCollateral",
        "args": {
          "_value": "330000000000000000000"
        },
        "expected": "0",
        "revertMessage": "Requested withdrawal is more than available collateral. total debt value: 30196764153578393315 ICX remaining collateral value: 120000000000000000000 ICX locking value (max debt): 120787056614313573260 ICX",
        "expected_sicx_baln_loan": "450000000000000000000",
        "expected_icd_debt_baln_loan": "50000000000000000000"
      }
    },
    {
      "description": "User 1 withdraws 329 ICX from the available collateral",
      "actions": {
        "prev_sicx_bal_loan": "450000000000000000000",
        "prev_icd_debt_bal_loan": "50000000000000000000",
        "sender": "user1",
        "name": "withdrawCollateral",
        "args": {
          "_value": "329000000000000000000"
        },
        "expected": "1",
        "expected_sicx_baln_loan": "121000000000000000000",
        "expected_icd_debt_baln_loan": "50000000000000000000"
      }
    },
    {
      "description": "User 1 withdraws -50 ICX from the available collateral",
      "actions": {
        "prev_sicx_bal_loan": "121000000000000000000",
        "prev_icd_debt_bal_loan": "50000000000000000000",
        "sender": "user1",
        "name": "withdrawCollateral",
        "args": {
          "_value": "-50000000000000000000"
        },
        "expected": "0",
        "revertMessage": "-50000000000000000000 sICX not sent to hxe7af5fcfd8dfc67530a01a0e403882687528dfcb. Exception: Transferring value cannot be less than 0.",
        "expected_sicx_baln_loan": "121000000000000000000",
        "expected_icd_debt_baln_loan": "50000000000000000000"
      }
    },
    {
      "description": "User 1 withdraws 121 ICX from the available collateral",
      "actions": {
        "prev_sicx_bal_loan": "121000000000000000000",
        "prev_icd_debt_bal_loan": "50000000000000000000",
        "sender": "user1",
        "name": "withdrawCollateral",
        "args": {
          "_value": "121000000000000000000"
        },
        "expected": "0",
        "revertMessage": "Requested withdrawal is more than available collateral. total debt value: 30196764153578393315 ICX remaining collateral value: 0 ICX locking value (max debt): 120787056614313573260 ICX",
        "expected_sicx_baln_loan": "121000000000000000000",
        "expected_icd_debt_baln_loan": "50000000000000000000"
      }
    }
  ]
}