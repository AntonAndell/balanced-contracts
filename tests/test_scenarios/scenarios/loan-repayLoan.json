{
  "title": "Loans: Repay loan ",
  "description": "Test cases for the repay loan.",
  "stories": [
    {
      "description": "User 1 deposits 500 ICX as collateral and borrows 50 bnUSD loan",
      "actions": {
        "prev_sicx_bal_loan": "0",
        "prev_icd_debt_bal_loan": "0",
        "prev_icd_bal_wallet": "0",
        "sender": "user1",
        "name": "depositAndBorrow",
        "deposited_icx": "500000000000000000000",
        "args": {
          "_asset": "bnUSD",
          "_amount": "50000000000000000000"
        },
        "expected": "1",
        "expected_sicx_baln_loan": "500000000000000000000",
        "expected_icd_debt_baln_loan": "50000000000000000000",
        "expected_icd_bal_wallet": "50000000000000000000"
      }
    },
    {
      "description": "user 1 repays a loan of 10 bnUSD by calling transfer method to bnUSD score.",
      "actions": {
        "prev_sicx_bal_loan" : "500000000000000000000",
        "prev_icd_debt_bal_loan" : "50000000000000000000",
        "prev_icd_bal_wallet": "50000000000000000000",
        "sender": "user1",
        "name": "transfer",
        "args": {
          "_to": "self.contracts['loans']['SCORE']",
          "_value": "10000000000000000000",
          "method": "_repay_loan",
          "params": "{}"
        },
        "expected" : "1",
        "expected_sicx_baln_loan" : "500000000000000000000",
        "expected_icd_debt_baln_loan" : "40000000000000000000",
        "expected_icd_bal_wallet": "40000000000000000000"
      }
    },
    {
      "description": "user 1 repays a loan of -10 bnUSD by calling transfer method to bnUSD score.",
      "actions": {
        "prev_sicx_bal_loan": "500000000000000000000",
        "prev_icd_debt_bal_loan": "0",
        "prev_icd_bal_wallet": "40000000000000000000",
        "sender": "user1",
        "name": "transfer",
        "args": {
          "_to": "self.contracts['loans']['SCORE']",
            "_value": "-10000000000000000000",
            "method": "_repay_loan",
            "params": "{}"
        },
        "expected": "0",
        "revertMessage": "Transferring value cannot be less than 0.",
        "expected_sicx_baln_loan": "500000000000000000000",
        "expected_icd_debt_baln_loan": "40000000000000000000",
        "expected_icd_bal_wallet": "40000000000000000000"
      }
    },
    {
      "description": "user 1 repays a loan of 40 bnUSD by calling transfer method to bnUSD score.",
      "actions": {
        "prev_sicx_bal_loan": "500000000000000000000",
        "prev_icd_debt_bal_loan": "40000000000000000000",
        "prev_icd_bal_wallet": "40000000000000000000",
        "sender": "user1",
        "name": "transfer",
        "args": {
          "_to": "self.contracts['loans']['SCORE']",
          "_value": "40000000000000000000",
          "method": "_repay_loan",
          "params": "{}"
        },
        "expected": "1",
        "expected_sicx_baln_loan": "500000000000000000000",
        "expected_icd_debt_baln_loan": "0",
        "expected_icd_bal_wallet": "0"
      }
    },
    {
      "description": "user 1 repays a loan of 40 bnUSD by calling transfer method to bnUSD score.",
      "actions": {
        "prev_sicx_bal_loan": "500000000000000000000",
        "prev_icd_debt_bal_loan": "0",
        "prev_icd_bal_wallet": "0",
        "sender": "user1",
        "name": "transfer",
        "args": {
          "_to": "self.contracts['loans']['SCORE']",
          "_value": "40000000000000000000",
          "method": "_repay_loan",
          "params": "{}"
        },
        "expected": "0",
        "revertMessage": "Insufficient balance.",
        "expected_sicx_baln_loan": "500000000000000000000",
        "expected_icd_debt_baln_loan": "0",
        "expected_icd_bal_wallet": "0"
      }
    }
  ]
}